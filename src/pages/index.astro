---
import BaseLayout from '../layouts/BaseLayout.astro';
import SoftwareCard from '../components/SoftwareCard.astro';
import FeatureMatrix from '../components/FeatureMatrix.astro';
import { getCollection } from 'astro:content';

const allSoftware = await getCollection('software');

// Sort software: ketamine-specific first, then by number of ketamine features
const sortedSoftware = allSoftware
  .map((s) => ({
    ...s.data,
    id: s.id,
    ketamineFeatureCount: Object.values(s.data.ketamine_features).filter(Boolean).length,
    isKetamineSpecific:
      s.data.ketamine_features.iv_protocols ||
      s.data.ketamine_features.im_protocols ||
      s.data.ketamine_features.ketamine_consent_forms,
  }))
  .sort((a, b) => {
    if (a.isKetamineSpecific && !b.isKetamineSpecific) return -1;
    if (!a.isKetamineSpecific && b.isKetamineSpecific) return 1;
    return b.ketamineFeatureCount - a.ketamineFeatureCount;
  });

const featuredSoftware = sortedSoftware.slice(0, 6);
const ketamineSpecificSoftware = sortedSoftware.filter((s) => s.isKetamineSpecific);

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Ketamine Software Directory',
  description: 'Compare EHR and practice management software for ketamine and psychedelic therapy clinics',
  url: 'https://ketaminesoftware.com',
};
---

<BaseLayout
  title="Ketamine Clinic Software Directory | Compare EHR & Practice Management"
  description="Compare the best EHR and practice management software for ketamine and psychedelic therapy clinics. Unbiased reviews, pricing, and feature comparisons."
  jsonLd={jsonLd}
>
  <!-- Hero Section -->
  <section class="relative overflow-hidden bg-slate-900 px-4 py-20 sm:px-6 lg:px-8 lg:py-28">
    <div class="absolute inset-0 bg-gradient-to-br from-teal-600/20 via-transparent to-cyan-600/20"></div>
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] bg-teal-500/10 rounded-full blur-3xl"></div>
    <div class="relative mx-auto max-w-7xl">
      <div class="mx-auto max-w-3xl text-center">
        <p class="text-teal-400 font-medium mb-4">Independent Software Directory</p>
        <h1 class="text-4xl font-bold tracking-tight text-white sm:text-5xl lg:text-6xl">
          Software Built for
          <span class="bg-gradient-to-r from-teal-400 to-cyan-400 bg-clip-text text-transparent"> Ketamine Clinics</span>
        </h1>
        <p class="mt-6 text-lg text-slate-300 sm:text-xl">
          Compare EHR, practice management, and billing software designed for ketamine and psychedelic therapy. Real pricing, honest reviews, and detailed feature comparisons.
        </p>
        <div class="mt-10 flex flex-col gap-4 sm:flex-row sm:justify-center">
          <a
            href="/software/"
            class="inline-flex items-center justify-center rounded-lg bg-teal-500 px-6 py-3.5 text-base font-semibold text-white shadow-lg shadow-teal-500/25 hover:bg-teal-400 transition-colors"
          >
            Browse All Software
            <svg class="ml-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
            </svg>
          </a>
          <a
            href="/compare/"
            class="inline-flex items-center justify-center rounded-lg border border-slate-600 bg-slate-800/50 px-6 py-3.5 text-base font-semibold text-white hover:bg-slate-700/50 transition-colors"
          >
            Compare Options
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="border-b border-gray-200 bg-white px-4 py-10 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <div class="grid grid-cols-2 gap-6 md:grid-cols-4">
        <div class="text-center px-4 py-2">
          <p class="text-3xl font-bold text-slate-900">{allSoftware.length}</p>
          <p class="mt-1 text-sm text-slate-500">Software Reviewed</p>
        </div>
        <div class="text-center px-4 py-2 border-l border-gray-200">
          <p class="text-3xl font-bold text-slate-900">{ketamineSpecificSoftware.length}</p>
          <p class="mt-1 text-sm text-slate-500">Ketamine-Specific</p>
        </div>
        <div class="text-center px-4 py-2 border-l border-gray-200">
          <p class="text-3xl font-bold text-slate-900">7</p>
          <p class="mt-1 text-sm text-slate-500">Feature Categories</p>
        </div>
        <div class="text-center px-4 py-2 border-l border-gray-200">
          <p class="text-3xl font-bold text-slate-900">100%</p>
          <p class="mt-1 text-sm text-slate-500">Independent</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Software -->
  <section class="px-4 py-16 sm:px-6 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-7xl">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-10">
        <div>
          <h2 class="text-2xl font-bold text-slate-900 sm:text-3xl">Featured Software</h2>
          <p class="mt-2 text-slate-600">
            Top-rated EHR and practice management solutions for ketamine clinics
          </p>
        </div>
        <a
          href="/software/"
          class="inline-flex items-center text-teal-600 hover:text-teal-700 font-medium"
        >
          View all {allSoftware.length} options
          <svg class="ml-1.5 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
          </svg>
        </a>
      </div>

      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {featuredSoftware.map((software) => (
          <SoftwareCard
            name={software.name}
            slug={software.slug}
            description={software.description}
            logo={software.logo}
            startingPrice={software.pricing.starting_price}
            currency={software.pricing.currency}
            pricingModel={software.pricing.model}
            hasFreeTrisl={software.pricing.has_free_trial}
            ketamineFeatureCount={software.ketamineFeatureCount}
            isKetamineSpecific={software.isKetamineSpecific}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Feature Matrix Section -->
  <section class="bg-slate-50 px-4 py-16 sm:px-6 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-7xl">
      <div class="text-center max-w-2xl mx-auto mb-10">
        <h2 class="text-2xl font-bold text-slate-900 sm:text-3xl">Ketamine Feature Comparison</h2>
        <p class="mt-3 text-slate-600">
          Compare ketamine-specific capabilities across all software options at a glance
        </p>
      </div>

      <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm lg:p-6">
        <FeatureMatrix software={sortedSoftware} />
      </div>
    </div>
  </section>

  <!-- Why Use This Directory -->
  <section class="px-4 py-16 sm:px-6 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-7xl">
      <div class="text-center max-w-2xl mx-auto mb-12">
        <h2 class="text-2xl font-bold text-slate-900 sm:text-3xl">Why Use This Directory?</h2>
        <p class="mt-3 text-slate-600">The only independent software directory built specifically for ketamine and psychedelic therapy practices</p>
      </div>

      <div class="grid gap-8 md:grid-cols-3">
        <div class="relative rounded-2xl border border-slate-200 bg-white p-6">
          <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-teal-50">
            <svg class="h-5 w-5 text-teal-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <h3 class="mt-4 text-lg font-semibold text-slate-900">Ketamine-Focused</h3>
          <p class="mt-2 text-slate-600 text-sm leading-relaxed">
            We evaluate software specifically for ketamine and psychedelic therapy workflowsâ€”IV/IM charting, SPRAVATO REMS, outcome tracking, and more.
          </p>
        </div>

        <div class="relative rounded-2xl border border-slate-200 bg-white p-6">
          <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-teal-50">
            <svg class="h-5 w-5 text-teal-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <h3 class="mt-4 text-lg font-semibold text-slate-900">Real Pricing</h3>
          <p class="mt-2 text-slate-600 text-sm leading-relaxed">
            We research and publish actual pricing whenever available. No more "contact for quote" guessing games.
          </p>
        </div>

        <div class="relative rounded-2xl border border-slate-200 bg-white p-6">
          <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-teal-50">
            <svg class="h-5 w-5 text-teal-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5" />
            </svg>
          </div>
          <h3 class="mt-4 text-lg font-semibold text-slate-900">Head-to-Head Comparisons</h3>
          <p class="mt-2 text-slate-600 text-sm leading-relaxed">
            Compare any two software options side-by-side on features, pricing, and ketamine-specific capabilities.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-slate-900 px-4 py-16 sm:px-6 lg:px-8 lg:py-20">
    <div class="mx-auto max-w-7xl">
      <div class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-teal-600 to-cyan-600 px-6 py-12 sm:px-12 sm:py-16">
        <div class="absolute top-0 right-0 -translate-y-1/4 translate-x-1/4 w-96 h-96 bg-white/10 rounded-full blur-3xl"></div>
        <div class="relative mx-auto max-w-2xl text-center">
          <h2 class="text-2xl font-bold text-white sm:text-3xl">Ready to Find Your Software?</h2>
          <p class="mt-4 text-teal-100">
            Browse our complete directory or use our comparison tool to find the perfect fit for your ketamine clinic.
          </p>
          <div class="mt-8 flex flex-col gap-4 sm:flex-row sm:justify-center">
            <a
              href="/software/"
              class="inline-flex items-center justify-center rounded-lg bg-white px-6 py-3 text-base font-semibold text-teal-700 hover:bg-teal-50 transition-colors"
            >
              Browse Directory
            </a>
            <a
              href="/guides/choosing-ketamine-ehr/"
              class="inline-flex items-center justify-center rounded-lg border border-white/30 bg-white/10 px-6 py-3 text-base font-semibold text-white hover:bg-white/20 transition-colors"
            >
              Read Buyer's Guide
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
