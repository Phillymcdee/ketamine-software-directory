---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allSoftware = await getCollection('software');

const sortedSoftware = allSoftware
  .map((s) => ({
    ...s.data,
    ketamineFeatureCount: Object.values(s.data.ketamine_features).filter(Boolean).length,
    isKetamineSpecific:
      s.data.ketamine_features.iv_protocols ||
      s.data.ketamine_features.im_protocols ||
      s.data.ketamine_features.ketamine_consent_forms,
  }))
  .sort((a, b) => b.ketamineFeatureCount - a.ketamineFeatureCount);

// Generate popular comparisons
const popularComparisons = [
  { a: 'osmind', b: 'clinifusion', label: 'Osmind vs CliniFusion' },
  { a: 'osmind', b: 'mediyeti', label: 'Osmind vs MediYeti' },
  { a: 'clinifusion', b: 'mediyeti', label: 'CliniFusion vs MediYeti' },
  { a: 'osmind', b: 'practiceq', label: 'Osmind vs PracticeQ' },
  { a: 'osmind', b: 'simplepractice', label: 'Osmind vs SimplePractice' },
  { a: 'valant', b: 'therapynotes', label: 'Valant vs TherapyNotes' },
];
---

<BaseLayout
  title="Compare Ketamine Clinic Software | Side-by-Side Comparisons"
  description="Compare ketamine clinic software side-by-side. See feature comparisons, pricing differences, and find the best EHR for your practice."
>
  <!-- Header -->
  <section class="bg-gradient-to-b from-gray-50 to-white px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <div class="max-w-3xl">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
          Compare Ketamine Clinic Software
        </h1>
        <p class="mt-4 text-lg text-gray-600">
          Select two software options to compare features, pricing, and ketamine-specific capabilities side-by-side.
        </p>
      </div>
    </div>
  </section>

  <!-- Comparison Selector -->
  <section class="px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-gray-900">Create Custom Comparison</h2>
        <form id="compare-form" class="mt-6 grid gap-6 md:grid-cols-3">
          <div>
            <label for="software-a" class="block text-sm font-medium text-gray-700">
              First Software
            </label>
            <select
              id="software-a"
              name="software-a"
              class="mt-2 block w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 focus:border-emerald-500 focus:ring-emerald-500"
            >
              <option value="">Select software...</option>
              {sortedSoftware.map((s) => (
                <option value={s.slug}>{s.name}</option>
              ))}
            </select>
          </div>

          <div>
            <label for="software-b" class="block text-sm font-medium text-gray-700">
              Second Software
            </label>
            <select
              id="software-b"
              name="software-b"
              class="mt-2 block w-full rounded-lg border border-gray-300 px-4 py-3 text-gray-900 focus:border-emerald-500 focus:ring-emerald-500"
            >
              <option value="">Select software...</option>
              {sortedSoftware.map((s) => (
                <option value={s.slug}>{s.name}</option>
              ))}
            </select>
          </div>

          <div class="flex items-end">
            <button
              type="submit"
              class="w-full rounded-lg bg-emerald-600 px-6 py-3 text-base font-medium text-white hover:bg-emerald-700"
            >
              Compare
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Popular Comparisons -->
  <section class="bg-gray-50 px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <h2 class="text-2xl font-bold text-gray-900">Popular Comparisons</h2>
      <p class="mt-2 text-gray-600">Most viewed head-to-head comparisons</p>

      <div class="mt-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {popularComparisons.map((comparison) => (
          <a
            href={`/compare/${comparison.a}-vs-${comparison.b}/`}
            class="flex items-center justify-between rounded-lg border border-gray-200 bg-white p-4 hover:border-emerald-300 hover:shadow-md"
          >
            <span class="font-medium text-gray-900">{comparison.label}</span>
            <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
            </svg>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- All Software Quick Compare -->
  <section class="px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <h2 class="text-2xl font-bold text-gray-900">All Software</h2>
      <p class="mt-2 text-gray-600">Click any software to start a comparison</p>

      <div class="mt-8 grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        {sortedSoftware.map((s) => (
          <a
            href={`/software/${s.slug}/`}
            class="flex items-center gap-3 rounded-lg border border-gray-200 bg-white p-4 hover:border-emerald-300"
          >
            <div class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-gray-100">
              <span class="text-lg font-bold text-gray-400">{s.name.charAt(0)}</span>
            </div>
            <div>
              <p class="font-medium text-gray-900">{s.name}</p>
              <p class="text-sm text-gray-500">
                {s.ketamineFeatureCount} ketamine features
              </p>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.getElementById('compare-form');
  form?.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(form as HTMLFormElement);
    const softwareA = formData.get('software-a');
    const softwareB = formData.get('software-b');

    if (softwareA && softwareB && softwareA !== softwareB) {
      window.location.href = `/compare/${softwareA}-vs-${softwareB}/`;
    } else {
      alert('Please select two different software options to compare.');
    }
  });
</script>
