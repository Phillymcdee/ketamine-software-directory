---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SoftwareCard from '../../components/SoftwareCard.astro';
import PricingTable from '../../components/PricingTable.astro';
import { getCollection } from 'astro:content';

const allSoftware = await getCollection('software');

const sortedSoftware = allSoftware
  .map((s) => ({
    ...s.data,
    id: s.id,
    ketamineFeatureCount: Object.values(s.data.ketamine_features).filter(Boolean).length,
    isKetamineSpecific:
      s.data.ketamine_features.iv_protocols ||
      s.data.ketamine_features.im_protocols ||
      s.data.ketamine_features.ketamine_consent_forms,
  }))
  .sort((a, b) => {
    if (a.isKetamineSpecific && !b.isKetamineSpecific) return -1;
    if (!a.isKetamineSpecific && b.isKetamineSpecific) return 1;
    return b.ketamineFeatureCount - a.ketamineFeatureCount;
  });

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: 'Ketamine Clinic Software Directory',
  description: 'Complete list of EHR and practice management software for ketamine and psychedelic therapy clinics',
  url: 'https://ketaminesoftware.directory/software/',
};
---

<BaseLayout
  title="All Ketamine Clinic Software | Compare EHR & Practice Management"
  description="Browse all EHR and practice management software for ketamine clinics. Compare features, pricing, and reviews to find the right solution for your practice."
  jsonLd={jsonLd}
>
  <!-- Header -->
  <section class="bg-gradient-to-b from-gray-50 to-white px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <div class="max-w-3xl">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
          Ketamine Clinic Software Directory
        </h1>
        <p class="mt-4 text-lg text-gray-600">
          Compare {allSoftware.length} EHR and practice management solutions for ketamine and psychedelic therapy practices. Filter by features, pricing, and ketamine-specific capabilities.
        </p>
      </div>
    </div>
  </section>

  <!-- Software Grid -->
  <section class="px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <!-- Category Filters -->
      <div class="mb-8 flex flex-wrap gap-2">
        <button
          class="rounded-full bg-emerald-600 px-4 py-2 text-sm font-medium text-white"
          data-filter="all"
        >
          All Software ({allSoftware.length})
        </button>
        <button
          class="rounded-full border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
          data-filter="ketamine"
        >
          Ketamine-Specific ({sortedSoftware.filter((s) => s.isKetamineSpecific).length})
        </button>
        <button
          class="rounded-full border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
          data-filter="free-trial"
        >
          Free Trial ({sortedSoftware.filter((s) => s.pricing.has_free_trial).length})
        </button>
      </div>

      <!-- Software Cards -->
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {sortedSoftware.map((software) => (
          <SoftwareCard
            name={software.name}
            slug={software.slug}
            description={software.description}
            logo={software.logo}
            startingPrice={software.pricing.starting_price}
            currency={software.pricing.currency}
            pricingModel={software.pricing.model}
            hasFreeTrisl={software.pricing.has_free_trial}
            ketamineFeatureCount={software.ketamineFeatureCount}
            isKetamineSpecific={software.isKetamineSpecific}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Pricing Comparison -->
  <section class="bg-gray-50 px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-7xl">
      <h2 class="text-2xl font-bold text-gray-900">Pricing Comparison</h2>
      <p class="mt-2 text-gray-600">
        Compare pricing across all ketamine clinic software options
      </p>

      <div class="mt-8 rounded-xl border border-gray-200 bg-white shadow-sm">
        <PricingTable software={sortedSoftware} />
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-3xl text-center">
      <h2 class="text-2xl font-bold text-gray-900">Need Help Choosing?</h2>
      <p class="mt-4 text-gray-600">
        Read our comprehensive guide to selecting the right EHR for your ketamine clinic.
      </p>
      <a
        href="/guides/choosing-ketamine-ehr/"
        class="mt-6 inline-flex items-center justify-center rounded-lg bg-emerald-600 px-6 py-3 text-base font-medium text-white hover:bg-emerald-700"
      >
        Read the Buyer's Guide
      </a>
    </div>
  </section>
</BaseLayout>
