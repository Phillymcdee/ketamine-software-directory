---
interface SoftwareData {
  name: string;
  slug: string;
  website: string;
  description: string;
  pricing: {
    model: string;
    starting_price: number | null;
    currency: string;
    has_free_trial: boolean;
    notes: string;
  };
  ketamine_features: Record<string, boolean>;
  pros: string[];
  cons: string[];
  ideal_for: string;
}

interface Props {
  softwareA: SoftwareData;
  softwareB: SoftwareData;
}

const { softwareA, softwareB } = Astro.props;

function formatPrice(price: number | null, currency: string): string {
  if (price === null) return 'Contact for pricing';
  if (price === 0) return 'Free tier available';
  const symbol = currency === 'CAD' ? 'CA$' : '$';
  return `From ${symbol}${price}/mo`;
}

function countKetamineFeatures(features: Record<string, boolean>): number {
  return Object.values(features).filter(Boolean).length;
}

const ketamineFeatureLabels: Record<string, string> = {
  iv_protocols: 'IV Protocols',
  im_protocols: 'IM Protocols',
  outcome_tracking: 'Outcome Tracking',
  spravato_workflows: 'SPRAVATOÂ® Workflows',
  patient_rating_scales: 'Rating Scales',
  ketamine_consent_forms: 'Consent Forms',
  treatment_series_tracking: 'Series Tracking',
};
---

<div class="overflow-hidden rounded-xl border border-slate-200 bg-white">
  <!-- Header -->
  <div class="grid grid-cols-3 border-b border-slate-200 bg-slate-50">
    <div class="p-4"></div>
    <div class="border-l border-slate-200 p-4 text-center">
      <a href={`/software/${softwareA.slug}/`} class="text-lg font-semibold text-slate-900 hover:text-teal-600">
        {softwareA.name}
      </a>
    </div>
    <div class="border-l border-slate-200 p-4 text-center">
      <a href={`/software/${softwareB.slug}/`} class="text-lg font-semibold text-slate-900 hover:text-teal-600">
        {softwareB.name}
      </a>
    </div>
  </div>

  <!-- Pricing -->
  <div class="grid grid-cols-3 border-b border-slate-200">
    <div class="p-4 font-medium text-slate-900">Pricing</div>
    <div class="border-l border-slate-200 p-4 text-center">
      <p class="font-semibold text-slate-900">{formatPrice(softwareA.pricing.starting_price, softwareA.pricing.currency)}</p>
      {softwareA.pricing.has_free_trial && (
        <span class="mt-1 inline-block rounded-full bg-teal-100 px-2 py-0.5 text-xs text-teal-700">Free Trial</span>
      )}
    </div>
    <div class="border-l border-slate-200 p-4 text-center">
      <p class="font-semibold text-slate-900">{formatPrice(softwareB.pricing.starting_price, softwareB.pricing.currency)}</p>
      {softwareB.pricing.has_free_trial && (
        <span class="mt-1 inline-block rounded-full bg-teal-100 px-2 py-0.5 text-xs text-teal-700">Free Trial</span>
      )}
    </div>
  </div>

  <!-- Ketamine Features Count -->
  <div class="grid grid-cols-3 border-b border-slate-200 bg-teal-50">
    <div class="p-4 font-medium text-slate-900">Ketamine Features</div>
    <div class="border-l border-teal-100 p-4 text-center">
      <span class="text-2xl font-bold text-teal-600">{countKetamineFeatures(softwareA.ketamine_features)}</span>
      <span class="text-sm text-slate-500"> / 7</span>
    </div>
    <div class="border-l border-teal-100 p-4 text-center">
      <span class="text-2xl font-bold text-teal-600">{countKetamineFeatures(softwareB.ketamine_features)}</span>
      <span class="text-sm text-slate-500"> / 7</span>
    </div>
  </div>

  <!-- Individual Ketamine Features -->
  {Object.entries(ketamineFeatureLabels).map(([key, label]) => (
    <div class="grid grid-cols-3 border-b border-slate-200">
      <div class="p-4 text-sm text-slate-600">{label}</div>
      <div class="border-l border-slate-200 p-4 text-center">
        {softwareA.ketamine_features[key] ? (
          <svg class="mx-auto h-5 w-5 text-teal-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>
        ) : (
          <svg class="mx-auto h-5 w-5 text-slate-300" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        )}
      </div>
      <div class="border-l border-slate-200 p-4 text-center">
        {softwareB.ketamine_features[key] ? (
          <svg class="mx-auto h-5 w-5 text-teal-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>
        ) : (
          <svg class="mx-auto h-5 w-5 text-slate-300" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        )}
      </div>
    </div>
  ))}

  <!-- Ideal For -->
  <div class="grid grid-cols-3 border-b border-slate-200">
    <div class="p-4 font-medium text-slate-900">Ideal For</div>
    <div class="border-l border-slate-200 p-4 text-sm text-slate-600">
      {softwareA.ideal_for}
    </div>
    <div class="border-l border-slate-200 p-4 text-sm text-slate-600">
      {softwareB.ideal_for}
    </div>
  </div>

  <!-- Pros -->
  <div class="grid grid-cols-3 border-b border-slate-200">
    <div class="p-4 font-medium text-slate-900">Pros</div>
    <div class="border-l border-slate-200 p-4">
      <ul class="space-y-1 text-sm">
        {softwareA.pros.slice(0, 3).map((pro) => (
          <li class="flex items-start gap-2">
            <svg class="mt-0.5 h-4 w-4 shrink-0 text-teal-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" />
            </svg>
            <span class="text-slate-600">{pro}</span>
          </li>
        ))}
      </ul>
    </div>
    <div class="border-l border-slate-200 p-4">
      <ul class="space-y-1 text-sm">
        {softwareB.pros.slice(0, 3).map((pro) => (
          <li class="flex items-start gap-2">
            <svg class="mt-0.5 h-4 w-4 shrink-0 text-teal-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" />
            </svg>
            <span class="text-slate-600">{pro}</span>
          </li>
        ))}
      </ul>
    </div>
  </div>

  <!-- Cons -->
  <div class="grid grid-cols-3">
    <div class="p-4 font-medium text-slate-900">Cons</div>
    <div class="border-l border-slate-200 p-4">
      <ul class="space-y-1 text-sm">
        {softwareA.cons.slice(0, 3).map((con) => (
          <li class="flex items-start gap-2">
            <svg class="mt-0.5 h-4 w-4 shrink-0 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z" />
            </svg>
            <span class="text-slate-600">{con}</span>
          </li>
        ))}
      </ul>
    </div>
    <div class="border-l border-slate-200 p-4">
      <ul class="space-y-1 text-sm">
        {softwareB.cons.slice(0, 3).map((con) => (
          <li class="flex items-start gap-2">
            <svg class="mt-0.5 h-4 w-4 shrink-0 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z" />
            </svg>
            <span class="text-slate-600">{con}</span>
          </li>
        ))}
      </ul>
    </div>
  </div>
</div>

<!-- CTAs -->
<div class="mt-6 grid grid-cols-2 gap-4">
  <a
    href={softwareA.website}
    target="_blank"
    rel="noopener noreferrer"
    class="inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-3 text-sm font-medium text-white hover:bg-teal-600"
  >
    Visit {softwareA.name}
    <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
    </svg>
  </a>
  <a
    href={softwareB.website}
    target="_blank"
    rel="noopener noreferrer"
    class="inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-3 text-sm font-medium text-white hover:bg-teal-600"
  >
    Visit {softwareB.name}
    <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
    </svg>
  </a>
</div>
